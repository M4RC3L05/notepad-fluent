<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Notepad</title>
    </head>
    <body>
        <script>
            ;(() => {
                const { ipcRenderer } = require('electron')
                const fs = require('fs')
                const os = require('os')
                const path = require('path')

                ipcRenderer.on('configChanged', () => applyConfig())
                applyConfig()

                function applyConfig() {
                    let config = loadConfig()

                    if (!config) return
                    saveConfigToLocalStorage(config)

                    if (localStorage.getItem('config'))
                        config = JSON.parse(localStorage.getItem('config'))
                    else config = null

                    if (config.colors) applyColors(config.colors)
                }

                function loadConfig() {
                    if (
                        !fs.existsSync(
                            path.resolve(
                                os.homedir(),
                                'notepad-fluent-config.json'
                            )
                        )
                    )
                        return null

                    return fs
                        .readFileSync(
                            path.resolve(
                                os.homedir(),
                                'notepad-fluent-config.json'
                            )
                        )
                        .toString()
                }

                function saveConfigToLocalStorage(config) {
                    localStorage.removeItem('config')

                    if (config && config.length > 0)
                        localStorage.setItem('config', config)
                }

                function applyColors(colors) {
                    if (!colors) return

                    for (const [key, style] of Object.entries(colors)) {
                        document.documentElement.style.setProperty(
                            '--' + key,
                            style
                        )
                    }
                }
            })()
        </script>
        <div class="top-bar">
            <div class="top-bar__title">Notepad Fluent</div>
            <div class="top-bar__buttons">
                <div class="icon" id="minimise"></div>
                <div class="icon" id="maximise"></div>
                <div class="icon" id="close"></div>
            </div>
        </div>
        <div class="side-bar">
            <div class="side-bar__item" id="menu">
                <div class="side-bar__icon"></div>
            </div>
            <div class="side-bar__item" id="close_file">
                <div class="side-bar__icon"></div>
                <div class="side-bar__description">
                    Close File
                </div>
            </div>
            <div class="side-bar__item" id="add_file">
                <div class="side-bar__icon"></div>
                <div class="side-bar__description">
                    New File
                </div>
            </div>
            <div class="side-bar__item" id="file">
                <div class="side-bar__icon"></div>
                <div class="side-bar__description">
                    Open File
                </div>
            </div>
            <div class="side-bar__item" style="margin-top: auto" id="settings">
                <div class="side-bar__icon"></div>
                <div class="side-bar__description">
                    Settings
                </div>
            </div>
        </div>
        <div id="editor-wrapper">
            <textarea id="editor"></textarea>
            <div class="bottom-status-bar">
                <div class="bottom-status-bar__encodingType"></div>
                <div class="bottom-status-bar__eolType"></div>
            </div>
        </div>
    </body>
</html>
